<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>DuckDuckGo Search Portal — Starter</title>
<style>
  body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;margin:0;background:#f6f8fb;color:#0b1020;display:flex;align-items:center;justify-content:center;height:100vh}
  .app{width:960px;max-width:95%;background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(10,20,40,.08);padding:22px}
  header{display:flex;align-items:center;gap:14px}
  .logo{width:54px;height:54px;border-radius:8px;background:#111;color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700}
  h1{margin:0;font-size:20px}
  form{display:flex;gap:8px;margin-top:16px}
  input[type="search"]{flex:1;padding:12px 14px;border-radius:10px;border:1px solid #e5e9ef;font-size:16px}
  .btn{padding:10px 14px;border-radius:10px;border:none;background:#111;color:#fff;font-weight:600;cursor:pointer}
  .secondary{background:#e9eef7;color:#0b1020}
  .row{display:flex;gap:12px;margin-top:12px;align-items:center}
  .panel{margin-top:16px;padding:14px;border-radius:10px;background:#f8fbff;border:1px solid #edf4ff}
  .muted{color:#6b7280;font-size:14px}
  .hint{font-size:14px;color:#0b1020;margin-top:8px}
  a.link{color:#0b6ef6;text-decoration:none}
</style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo">DDG</div>
      <div>
        <h1>Search Portal</h1>
        <div class="muted">Search powered by DuckDuckGo — legal, privacy-focused, and fast.</div>
      </div>
    </header>

    <form id="searchForm" onsubmit="return handleSubmit(event)">
      <input id="q" type="search" placeholder="Search DuckDuckGo (try: 'Newton', 'Avengers', 'binary to decimal')" autocomplete="off" required />
      <button class="btn" type="submit">Open results</button>
      <button id="previewBtn" class="btn secondary" type="button">Preview (Instant Answer)</button>
    </form>

    <div class="row">
      <label><input id="openNew" type="checkbox" checked/> Open results in new tab</label>
      <div style="margin-left:auto" class="muted">You can add this page to your portal header.</div>
    </div>

    <div id="preview" class="panel" style="display:none">
      <div id="previewTitle" style="font-weight:700"></div>
      <div id="previewText" class="hint"></div>
      <div id="previewMore" style="margin-top:8px"></div>
    </div>

    <div style="margin-top:14px" class="muted small">Notes: "Preview" uses DuckDuckGo Instant Answer JSONP. For full results we redirect to duckduckgo.com.</div>
  </div>

<script>
  // Open full DuckDuckGo results (simple redirect)
  function handleSubmit(e){
    e.preventDefault();
    const q = document.getElementById('q').value.trim();
    if(!q) return false;
    const url = 'https://duckduckgo.com/?q=' + encodeURIComponent(q);
    const newTab = document.getElementById('openNew').checked;
    if(newTab) window.open(url, '_blank');
    else window.location.href = url;
    return false;
  }

  // Instant Answer preview via JSONP (no CORS)
  document.getElementById('previewBtn').addEventListener('click', () => {
    const q = document.getElementById('q').value.trim();
    if(!q) { alert('Type a query first'); return; }
    showPreviewLoading();
    fetchInstantAnswerJSONP(q, renderPreview);
  });

  function showPreviewLoading(){
    const p = document.getElementById('preview');
    p.style.display = 'block';
    document.getElementById('previewTitle').textContent = 'Loading...';
    document.getElementById('previewText').textContent = '';
    document.getElementById('previewMore').innerHTML = '';
  }

  // JSONP loader for DDG Instant Answer
  function fetchInstantAnswerJSONP(query, cb){
    const cbName = 'ddg_cb_' + Date.now() + '_' + Math.floor(Math.random()*9999);
    window[cbName] = function(data){
      try { cb(null, data); } catch(err) { cb(err); }
      cleanup();
    };
    function cleanup(){
      try{ delete window[cbName]; }catch(e){}
      const s = document.getElementById(cbName);
      if(s) s.parentNode.removeChild(s);
    }
    const script = document.createElement('script');
    script.id = cbName;
    const api = 'https://api.duckduckgo.com/?q=' + encodeURIComponent(query) + '&format=json&pretty=1&callback=' + cbName;
    script.src = api;
    script.onerror = function(){ cb(new Error('JSONP request failed')); cleanup(); };
    document.body.appendChild(script);
  }

  // Render Instant Answer response
  function renderPreview(err, data){
    if(err || !data){
      document.getElementById('previewTitle').textContent = 'No preview available';
      document.getElementById('previewText').textContent = err ? err.message : 'No data';
      return;
    }

    const titleEl = document.getElementById('previewTitle');
    const textEl  = document.getElementById('previewText');
    const moreEl  = document.getElementById('previewMore');

    // Highest-value fields: AbstractText, AbstractURL, Answer, Redirect
    if(data.AbstractText){
      titleEl.textContent = data.Heading || 'Instant answer';
      textEl.textContent = data.AbstractText;
      if(data.AbstractURL) moreEl.innerHTML = '<a class="link" href="' + encodeURI(data.AbstractURL) + '" target="_blank">Read more</a>';
    } else if(data.Answer){
      titleEl.textContent = data.Heading || 'Answer';
      textEl.textContent = data.Answer;
      if(data.Redirect) moreEl.innerHTML = '<a class="link" href="' + encodeURI(data.Redirect) + '" target="_blank">Open source</a>';
    } else if(data.RelatedTopics && data.RelatedTopics.length){
      titleEl.textContent = data.Heading || 'Related topics';
      // show first related topic(s)
      const rt = data.RelatedTopics.filter(t => t.Text).slice(0,3);
      textEl.textContent = rt.map(t => t.Text).join(' — ');
      const link = 'https://duckduckgo.com/?q=' + encodeURIComponent(document.getElementById('q').value.trim());
      moreEl.innerHTML = '<a class="link" href="' + link + '" target="_blank">Full results</a>';
    } else {
      titleEl.textContent = 'No Instant Answer';
      textEl.textContent = data.Redirect ? ('Redirects to: ' + data.Redirect) : 'No concise answer available.';
      moreEl.innerHTML = '<a class="link" href="https://duckduckgo.com/?q=' + encodeURIComponent(document.getElementById('q').value.trim()) + '" target="_blank">See full results</a>';
    }
  }

  // Press Enter to preview (optional UX)
  document.getElementById('q').addEventListener('keydown', (e) => {
    if(e.key === 'Enter' && e.shiftKey){
      e.preventDefault();
      document.getElementById('previewBtn').click();
    }
  });
</script>
</body>
</html>
